{% extends "base.html" %}

{% block title %}{{ listing.title }} - HostHub{% endblock %}

{% block content %}
<div class="container">
    <!-- Breadcrumb -->
    <nav aria-label="breadcrumb" class="mt-3">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{{ url_for('traveler.dashboard') }}">Dashboard</a></li>
            <li class="breadcrumb-item"><a href="{{ url_for('traveler.search_listings') }}">Search</a></li>
            <li class="breadcrumb-item active">{{ listing.title }}</li>
        </ol>
    </nav>

    <div class="row">
        <!-- Main Content -->
        <div class="col-md-8">
            <div class="card">
                <div class="card-body">
                    <!-- Listing Title -->
                    <h1 class="h2 mb-3">{{ listing.title }}</h1>
                    
                    <!-- Location -->
                    <p class="text-muted mb-4">
                        <i class="bi bi-geo-alt"></i>
                        {{ listing.city }}, {{ listing.country }}
                        {% if listing.state %}({{ listing.state }}){% endif %}
                    </p>
                    
                    <!-- Key Details -->
                    <div class="row mb-4">
                        <div class="col-sm-4">
                            <div class="card border h-100">
                                <div class="card-body text-center">
                                    <i class="bi bi-clock mb-2 text-primary h4"></i>
                                    <h6 class="text-muted">Work Hours</h6>
                                    <p class="h5 mb-0">{{ listing.work_hour }}h/week</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-4">
                            <div class="card border h-100">
                                <div class="card-body text-center">
                                    <i class="bi bi-calendar mb-2 text-primary h4"></i>
                                    <h6 class="text-muted">Duration</h6>
                                    <p class="h5 mb-0">{{ listing.duration_day }} days</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-4">
                            <div class="card border h-100">
                                <div class="card-body text-center">
                                    <i class="bi bi-briefcase mb-2 text-primary h4"></i>
                                    <h6 class="text-muted">Work Type</h6>
                                    <p class="h5 mb-0">{{ listing.work_type }}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Description -->
                    <h4>Description</h4>
                    <p class="mb-4">{{ listing.description }}</p>
                    
                    <!-- Application Button -->
                    {% if current_user.is_authenticated and current_user.role_type == 'traveler' %}
                        {% if not already_applied %}
                            <button type="button" class="btn btn-primary btn-lg" 
                                    data-bs-toggle="modal" data-bs-target="#applyModal">
                                Apply Now
                            </button>
                        {% else %}
                            <button class="btn btn-secondary btn-lg" disabled>Already Applied</button>
                        {% endif %}
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Sidebar -->
        <div class="col-md-4">
        <!-- Host Info -->
        <div class="card mb-4">
          <div class="card-body">
              <h4 class="card-title">About the Host</h4>
              <h5 class="card-subtitle mb-3">{{ listing.host_name }}</h5>
              
              {% if listing.host_rating %}
              <div class="mb-3">
                  <div class="d-flex align-items-center">
                      <div class="h5 mb-0 me-2">{{ "%.1f"|format(listing.host_rating) }}</div>
                      <div class="text-warning">
                          {% for i in range(5) %}
                              {% if i < listing.host_rating|int %}
                                  <i class="bi bi-star-fill"></i>
                              {% else %}
                                  <i class="bi bi-star"></i>
                              {% endif %}
                          {% endfor %}
                      </div>
                  </div>
                  {% if listing.total_reviews %}
                      <small class="text-muted">({{ listing.total_reviews }} reviews)</small>
                  {% endif %}
              </div>
              {% endif %}
              
              {% if listing.preferred_language %}
              <p class="mb-2">
                  <i class="bi bi-translate me-2"></i>
                  Speaks: {{ listing.preferred_language }}
              </p>
              {% endif %}
              
              <p class="mb-0">
                  <i class="bi bi-calendar-check me-2"></i>
                  Member since {{ listing.created_at.strftime('%B %Y') }}
              </p>
          </div>
        </div>

            <!-- Other Listings -->
            {% if other_listings %}
            <div class="card">
                <div class="card-body">
                    <h4 class="card-title">More Listings from this Host</h4>
                    <div class="list-group list-group-flush">
                        {% for other in other_listings %}
                        <a href="{{ url_for('traveler.view_listing', listing_id=other.listing_id) }}"
                           class="list-group-item list-group-item-action">
                            <h6 class="mb-1">{{ other.title }}</h6>
                            <small class="text-muted">
                                <i class="bi bi-geo-alt"></i>
                                {{ other.city }}, {{ other.country }}
                            </small>
                        </a>
                        {% endfor %}
                    </div>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- Application Modal -->
{% if current_user.is_authenticated and current_user.role_type == 'traveler' and not already_applied %}
<div class="modal fade" id="applyModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Apply for "{{ listing.title }}"</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="introduction" class="form-label">Introduction</label>
                        <textarea class="form-control" id="introduction" name="introduction" 
                                  rows="5" required
                                  placeholder="Tell the host about yourself and why you're interested in this opportunity..."></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Submit Application</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endif %}
{% endblock %}